<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Recipes with Angular.js - Sharing Code Between Controllers using Services</title>
    <meta keywords="javascript, js, angular.js, angularjs, recipes with angular.js, recipes with angularjs, best practices, cookbook, tutorial, book">
    <meta name="viewport" content="width=device-width">

    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>

    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:300,400' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="/recipes-with-angular-js/css/application.css" type="text/css" media="all" />
  </head>
    <body ng-app="RecipesApp">

      <div class="contain-to-grid">
        <nav class="top-bar">
          <ul class="title-area">
            <li class="name">
              <h1>
                <a href="/recipes-with-angular-js/">
                  <img class="logo-image" src="/recipes-with-angular-js/images/AngularJS-Shield-small.png" alt="" width="36" height="36">
                  <span>Recipes with Angular.js</span>
                </a>
              </h1>
            </li>
            <li class="toggle-topbar menu-icon">
              <a href="#"><span>Menu</span></a>
            </li>
          </ul>

          <section class="top-bar-section2">
            <ul class="right" style="position: relative">
              <li class="has-form">
                <div class="row collapse">
                  <div class="large-8 small-9 columns">
                    <input type="text" id="search-query" name="q" autocomplete="off" placeholder="Search recipes">
                  </div>
                  <div class="large-4 small-3 columns">
                    <a href="#" class="alert button expand top-bar-button">Search</a>
                  </div>
                </div>
              </li>

              <div id="search-results" style="display: none;">
                <ul class="entries">
                </ul>
              </div>
            </ul>
          </section>
        </nav>
      </div>

      <div class="row">
        <div class="large-12 columns">
          <div class="row">
  <div class="large-3 medium-6 columns">
    <ul class="side-nav">
  <li> <a href="/recipes-with-angular-js/index.html">Home</a> </li>
  
    <li >
      <a href="/recipes-with-angular-js/introduction/index.html">Introduction</a>

      

    </li>
  
    <li  class="active" >
      <a href="/recipes-with-angular-js/controllers/index.html">Controllers</a>

      
        <ul>
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
          
            
          
            
              
                <li >
                  <a href="/recipes-with-angular-js//controllers/assigning-a-default-value-to-a-model.html">Assigning a Default Value to a Model</a>
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li >
                  <a href="/recipes-with-angular-js//controllers/changing-a-model-value-with-a-controller-function.html">Changing a Model Value with a Controller Function</a>
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li >
                  <a href="/recipes-with-angular-js//controllers/encapsulation-a-model-value-with-a-controller-function.html">Encapsulating a Model Value with a Controller Function</a>
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li >
                  <a href="/recipes-with-angular-js//controllers/responding-to-scope-changes.html">Responding to Scope Changes</a>
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li >
                  <a href="/recipes-with-angular-js//controllers/sharing-models-between-nested-controllers.html">Sharing Models Between Nested Controllers</a>
                </li>
              
            
          
            
          
            
              
                <li  class="active" >
                  <a href="/recipes-with-angular-js//controllers/sharing-code-between-controllers-using-services.html">Sharing Code Between Controllers using Services</a>
                </li>
              
            
          
            
          
            
          
            
          
            
          
            
          
            
              
                <li >
                  <a href="/recipes-with-angular-js//controllers/testing-controllers.html">Testing Controllers</a>
                </li>
              
            
          
            
          
            
          
            
          
        </ul>
      

    </li>
  
    <li >
      <a href="/recipes-with-angular-js/directives/index.html">Directives</a>

      

    </li>
  
    <li >
      <a href="/recipes-with-angular-js/filters/index.html">Filters</a>

      

    </li>
  
    <li >
      <a href="/recipes-with-angular-js/using-forms/index.html">Using Forms</a>

      

    </li>
  
    <li >
      <a href="/recipes-with-angular-js/consuming-external-services/index.html">Consuming External Services</a>

      

    </li>
  
    <li >
      <a href="/recipes-with-angular-js/urls-routing-and-partials/index.html">Urls Routing and Partials</a>

      

    </li>
  
    <li >
      <a href="/recipes-with-angular-js/common-user-interface-patterns/index.html">Common User Interface Patterns</a>

      

    </li>
  
    <li >
      <a href="/recipes-with-angular-js/backend-integration-with-ruby-on-rails/index.html">Backend Integration with Ruby on Rails</a>

      

    </li>
  
    <li >
      <a href="/recipes-with-angular-js/backend-integration-with-node-express/index.html">Backend Integration with Node Express</a>

      

    </li>
  

  <!-- <li >
    <a href="/recipes-with-angular-js/introduction/index.html">Introduction</a>
    
  </li>

  <li  class="active" >
    <a href="/recipes-with-angular-js/controllers/index.html">Controllers</a>
    
      <ul>
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            <li>
              <a href="/recipes-with-angular-js/controllers/index.html">Controllers</a>
            </li>
          
        
          
        
          
        
          
            <li>
              <a href="/recipes-with-angular-js/controllers/assigning-a-default-value-to-a-model.html">Assigning a Default Value to a Model</a>
            </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            <li>
              <a href="/recipes-with-angular-js/controllers/changing-a-model-value-with-a-controller-function.html">Changing a Model Value with a Controller Function</a>
            </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            <li>
              <a href="/recipes-with-angular-js/controllers/encapsulation-a-model-value-with-a-controller-function.html">Encapsulating a Model Value with a Controller Function</a>
            </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            <li>
              <a href="/recipes-with-angular-js/controllers/responding-to-scope-changes.html">Responding to Scope Changes</a>
            </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            <li>
              <a href="/recipes-with-angular-js/controllers/sharing-models-between-nested-controllers.html">Sharing Models Between Nested Controllers</a>
            </li>
          
        
          
        
          
            <li>
              <a href="/recipes-with-angular-js/controllers/sharing-code-between-controllers-using-services.html">Sharing Code Between Controllers using Services</a>
            </li>
          
        
          
        
          
        
          
        
          
        
          
        
          
            <li>
              <a href="/recipes-with-angular-js/controllers/testing-controllers.html">Testing Controllers</a>
            </li>
          
        
          
        
          
        
          
        
      </ul>
    
  </li>

  <li >
    <a href="/recipes-with-angular-js/directives/index.html">Directives</a>
    
  </li>

  <li >
    <a href="/recipes-with-angular-js/filters/index.html">Filters</a>
    
  </li>

  <li >
    <a href="/recipes-with-angular-js/consuming-external-services/index.html">Consuming External Services</a>
    
  </li>

  <li >
    <a href="/recipes-with-angular-js/urls-routing-and-partials/index.html">URLs, Routing and Partials</a>
    
  </li>

  <li >
    <a href="/recipes-with-angular-js/common-user-interface-patterns/index.html">Common User Interface Patterns</a>
    
  </li>

  <li >
    <a href="/recipes-with-angular-js/backend-integration-with-ruby-on-rails/index.html">Backend Integration with Ruby on Rails</a>
    
  </li>

  <li >
    <a href="/recipes-with-angular-js/backend-integration-with-node-express/index.html">Backend Integration with Node Express</a>
    
  </li> -->
</ul>
  </div>
  <div class="large-9 medium-6 columns content">
    <h2>Sharing Code Between Controllers using Services</h2>
    <h3 id="problem">Problem</h3>
<p>You wish to share business logic between controllers.</p>

<h3 id="solution">Solution</h3>
<p>Utilise a <a href="http://docs.angularjs.org/guide/dev_guide.services">Service</a> to implement your business logic and use dependency injection to use this service in your controllers.</p>

<p>The template shows access to a list of users from two controllers:</p>

<div>
  <pre data-line=""><code class="language-markup">&lt;div ng-controller=&quot;MyCtrl&quot;&gt;
  &lt;ul ng-repeat=&quot;user in users&quot;&gt;
    &lt;li&gt;{{user}}&lt;/li&gt;
  &lt;/ul&gt;
  &lt;div class=&quot;nested&quot; ng-controller=&quot;AnotherCtrl&quot;&gt;
    First user: {{firstUser}}
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
</div>

<p>The service and controller implementation in <code>app.js</code> implements a user service and the controllers set the scope initially:</p>

<div>
  <pre data-line=""><code class="language-javascript">var app = angular.module(&quot;MyApp&quot;, []);

app.factory(&quot;UserService&quot;, function() {
  var users = [&quot;Peter&quot;, &quot;Daniel&quot;, &quot;Nina&quot;];

  return {
    all: function() {
      return users;
    },
    first: function() {
      return users[0];
    }
  };
});

app.controller(&quot;MyCtrl&quot;, function($scope, UserService) {
  $scope.users = UserService.all();
});

app.controller(&quot;AnotherCtrl&quot;, function($scope, UserService) {
  $scope.firstUser = UserService.first();
});</code></pre>
</div>

<p>You can find the complete example on <a href="https://github.com/fdietz/recipes-with-angular-js-examples/tree/master/chapter2/recipe6">github</a>.</p>

<h3 id="discussion">Discussion</h3>
<p>The <code>factory</code> method creates a singleton <code>UserService</code>, that returns two functions for retrieving all users and the first user only. The controllers get the <code>UserService</code> injected by adding it to the <code>controller</code> function as params.</p>

<p>Using dependency injection here is quite nice for testing your controllers, since you can easily inject a <code>UserService</code> stub. The only downside is that you can’t minify the code from above without breaking it, since the injection mechanism relies on the exact string representation of <code>UserService</code>. It is therefore recommended to define dependencies using inline annotations, which keeps working even when minified:</p>

<div>
  <pre data-line=""><code class="language-javascript">app.controller(&quot;AnotherCtrl&quot;, [&quot;$scope&quot;, &quot;UserService&quot;,
  function($scope, UserService) {
    $scope.firstUser = UserService.first();
  }
]);</code></pre>
</div>

<p>The syntax looks a bit funny, but since strings in arrays are not changed during the minification process it solves our problem. Note that you could change the parameter names of the function, since the injection mechanism relies on the order of the array definition only.</p>

<p>Another way to achieve the same is using the <code>$inject</code> annotation:</p>

<div>
  <pre data-line=""><code class="language-javascript">var anotherCtrl = function($scope, UserService) {
  $scope.firstUser = UserService.first();
};

anotherCtrl.$inject = [&quot;$scope&quot;, &quot;UserService&quot;];</code></pre>
</div>

<p>This requires you to use a temporary variable to call the <code>$inject</code> service. Again, you could change the function parameter names. You will most probably see both versions applied in apps using Angular.</p>



    <!-- <div class="recipe-actions">
      
        <form class="jsfiddle" method="post" action="http://jsfiddle.net/api/post/library/pure/" target="_blank">
              <input type="hidden" name="html" value="&lt;body ng-app=&quot;MyApp&quot;&gt;
  &lt;div ng-controller=&quot;MyCtrl&quot;&gt;
    &lt;ul ng-repeat=&quot;user in users&quot;&gt;
      &lt;li&gt;&#123;&#123;user&#125;&#125;&lt;/li&gt;
    &lt;/ul&gt;
    &lt;div class=&quot;nested&quot; ng-controller=&quot;AnotherCtrl&quot;&gt;
      First user: &#123;&#123;firstUser&#125;&#125;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/body&gt;"></input>

              <input type="hidden" name="js" value="var app = angular.module(&quot;MyApp&quot;, []);

app.factory(&quot;UserService&quot;, function() {
  var users = [&quot;Peter&quot;, &quot;Daniel&quot;, &quot;Nina&quot;];

  return {
    all: function() {
      return users;
    },
    first: function() {
      return users[0];
    }
  };
});

app.controller(&quot;MyCtrl&quot;, function($scope, UserService) {
  $scope.users = UserService.all();
});

app.controller(&quot;AnotherCtrl&quot;, function($scope, UserService) {
  $scope.firstUser = UserService.first();
});"></input>

              <input type="hidden" name="css" value=".nested {
  border: 1px solid red;
  margin-left: 2em;
  padding: 1em;
}"></input>

              <input type="hidden" name="resources" value="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js,http://code.jquery.com/jquery-1.10.1.min.js,http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css"></input>

        <button class="btn small btn-primary">Edit in jsfiddle</button>
      </form>
      
    </div> -->

    <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'recipes-with-angularjs-site'; // required: replace example  with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
 </div>
</div>

        </div>
      </div>

      <footer>
        <div class="row">
          <div class="large-12 columns">
            <div class="row">
              <div class="large-6 columns">
                <p>
                  Maintained by <a href="http://fdietz.de">Frederik Dietz</a>
                </p>
              </div>

              <div class="large-6 columns text-right">
                <p>All content licensed with <a href="http://creativecommons.org/">Creative Commons</a></p>
              </div>
            </div>
          </div>
        </div>
      </footer>

      
        <script id="search-results-template" type="text/mustache">
          {{#entries}}
            <li>
              <a href="/recipes-with-angular-js{{url}}">{{title}}</a>
            </li>
          {{/entries}}
        </script>
      

      <script src="/recipes-with-angular-js/js/application.js" type="text/javascript" charset="utf-8"></script>
      <script src="/recipes-with-angular-js/js/jquery.js"></script>
      <script src="/recipes-with-angular-js/js/foundation.min.js" type="text/javascript" charset="utf-8"></script>
      <script src="/recipes-with-angular-js/js/prism.js" type="text/javascript" charset="utf-8"></script>

      <script src="/recipes-with-angular-js/js/date.format.js"></script>
      <script src="/recipes-with-angular-js/js/mustache.js"></script>
      <script src="/recipes-with-angular-js/js/URI.min.js"></script>
      <script src="/recipes-with-angular-js/js/lunr.js"></script>
      <script src="/recipes-with-angular-js/js/jquery.lunr.search.js"></script>

      <script>
        $(document).foundation();
      </script>

      <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-42557266-1']);
        _gaq.push(['_trackPageview']);

        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

      </script>

      <script type="text/javascript">
        $(function() {
          $('#search-query').lunrSearch({
            indexUrl: '/recipes-with-angular-js/search.json',
            results:  '#search-results',
            entries:  '.entries',
            template: '#search-results-template'
          });

        });
      </script>
    </body>
</html>
